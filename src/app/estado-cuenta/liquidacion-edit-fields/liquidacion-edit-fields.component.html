<div *ngIf="item">

  <form [formGroup]="form">

    <app-liquidacion-edit-form-acciones
      style="display: flex;flex-direction: row;justify-content: flex-end; padding-right: 20px;"
      [isShow]="isShow"
      [liquidacion]="item"
      (liquidacionChange)="actualizarLiquidacion.emit()"
      (liquidacionFlujoChange)="actualizarEstado.emit($event)"
      (liquidacionFacturaChange)="actualizarFactura($event)"      
      [saldoCC]="childSaldoView?.saldo"
      [totalMovimiento]="(credito-debito)"      
      [form]="form"
    ></app-liquidacion-edit-form-acciones>

    <div style="padding-top: 10px;">

      <app-estado-cuenta-detalle
        [etapa]="etapa"
        [estadoLiqui]="item.estado"
        [estadoCuenta]="estadoCuenta"
        [showVistaConsolidada]="false"
        [showEstado]="false"
        [showEstadoLiqui]="true"
        [showLiquidacion]="true"
        [liquidacionId]="item.id"
        [form]="form"
      ></app-estado-cuenta-detalle>

      <app-saldo
        #saldoView
        [showIngresoEgreso]="false"
        [showResumen]="true"
        [esEdicion]="true"
        [credito]="credito"
        [debito]="debito"
        [saldoFinalizado]="saldoFinalizado"
        [saldoCC]="saldoCC"
        [esOrdenPago]="esOrdenPago"
        [esFinalizado]="esFinalizado"
        [form]="form"
        (saldoChange)="saldo = $event"
        (monedaSelect)="selectMoneda($event)">
      ></app-saldo>
    </div>

    <ng-container *ngIf="esFinalizado; else pendienteTemp">

      <div class="section">
        <h2 class="title-colapside" (click)="colapseDivMovimientos=!colapseDivMovimientos">MOVIMIENTOS</h2>
        <app-liquidacion-movimientos
          [class.colapse-div]="colapseDivMovimientos"
          [list]="movimientos"
          (selectedMovimientosChange)="actualizarLiquidacion.emit()"
        ></app-liquidacion-movimientos>
      </div>

      <div *ngIf="facturas.length>0" class="section section-button">
        <h2 class="title-colapside" (click)="colapseDivFacturas=!colapseDivFacturas">FACTURAS</h2>
        <app-liquidacion-confirmada-form-facturas
          [class.colapse-div]="colapseDivFacturas"
          [liquidacion]="item"
          [isShow]="isShow"
          (facturasChange)="actualizarLiquidacion.emit()"
        ></app-liquidacion-confirmada-form-facturas>
      </div>

      <div class="section section-button">
        <h2 class="title-colapside" (click)="colapseDivInstrumentos=!colapseDivInstrumentos">INSTRUMENTOS</h2>
        <app-liquidacion-instrumentos
          [class.colapse-div]="colapseDivInstrumentos"
          [list]="instrumentos"
          [isShow]="isShow"
          [liquidacion]="item"
        ></app-liquidacion-instrumentos>
        <app-liquidacion-confirmada-form-instrumentos
          [class.colapse-div]="colapseDivInstrumentos"
          [estadoCuenta]="estadoCuenta"
          [liquidacion]="item"
          [saldo]="montoLiquidacion"
          [totalMonedas]=totalMonedas
          [isShow]="isShow"
          (selectedInstrumentosChange)="actualizarLiquidacion.emit()"
        ></app-liquidacion-confirmada-form-instrumentos>
      </div>

    </ng-container>

    <ng-template #pendienteTemp>

      <div class="section">
        <h2 class="title-colapside" (click)="colapseDivMovimientos=!colapseDivMovimientos">MOVIMIENTOS</h2>
        <app-liquidacion-edit-form-movimientos
          [class.colapse-div]="colapseDivMovimientos"
          [list]="movimientos"
          [liquidacion]="item"
          [esOrdenPago]="esOrdenPago"
          [saldo]="saldo"
          [isShow]="
            isShow ||
            item.estado === E.ACEPTADO ||
            item.estado === E.CANCELADO ||
            item.estado === E.CONFIRMADO
          "
          (selectedMovimientosChange)="actualizarMovimientosEvento($event)">
        </app-liquidacion-edit-form-movimientos>

      </div>

      <div *ngIf="facturas.length>0" class="section section-button">
        <h2 class="title-colapside" (click)="colapseDivFacturas=!colapseDivFacturas">FACTURAS</h2>
        <app-liquidacion-confirmada-form-facturas
          [class.colapse-div]="colapseDivFacturas"
          #facturaList
          [liquidacion]="item"
          [isShow]="isShow"
          (facturasChange)="actualizarFactura($event)"
        ></app-liquidacion-confirmada-form-facturas>
        </div>

    </ng-template>

    <div *ngIf="comentario !== ''" class="section">
      <h2 class="title-colapside" (click)="colapseDivHistorico=!colapseDivHistorico">HISTORICO</h2>
      <app-liquidacion-comentario
        [class.colapse-div]="colapseDivHistorico"
        [comentario]="comentario"
      ></app-liquidacion-comentario>
    </div>

  </form>

</div>
