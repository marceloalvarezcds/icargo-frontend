<form #form [formGroup]="formGroup" (ngSubmit)="submitEvent.emit()">
  <div class="page-form-component">

    <div class="page-title"  style="align-items: center;">

      <span class="title">

        <span [ngClass]="{
            'module':true,
            'edicion-mode': isEdit,
            'ver-mode': isShow && !isEdit,
            'nuevo-mode': !isShow && !isEdit
            }"
            [ngStyle]="estilosPersonalesModule">
          {{ module }}
        </span>
        <span [ngClass]="{
            'submodule':true,
            'edicion-mode': isEdit,
            'ver-mode': isShow && !isEdit,
            'nuevo-mode': !isShow && !isEdit
          }"
            [ngStyle]="estilosPersonalesSubModule">
          {{ submodule }}
        </span>
        <strong class="view-title" >{{ viewTitle }}</strong>

      </span>

      <div *ngIf="!isDialog" class="page-title-buttons">

        <button
          mat-stroked-button
          type="button"
          color="primary"
          matTooltip="Volver al listado"
          [disabled]="loading"
          (click)="backClick.emit()"
          id="back-button"
          class="botones list-button"
        >
          <mat-icon>arrow_back</mat-icon>
          VOLVER
        </button>

        <!-- FIXME -->
        <div *ngIf="(submodule === 'PROPIETARIOS' || submodule === 'CHOFER' || submodule === 'TRACTOS'
         || submodule === 'PEDIDOS' || submodule === 'SEMI') && !isEdit && !isShow" class="estado-container">
          <label for="estado-input" class="estado-label">ESTADO</label>
          <input
              id="estado-input"
              type="text"
              value="PENDIENTE"
              [ngClass]="{'button-disabled': isFormSubmitting}"
              [readonly]="isFormSubmitting"
              class="estado-input"
          />
        </div>

        <!-- TODO: este grupo de botones debe pasarse por parametro -->
        <div class="estado-container"  [ngClass]="{'estado-cancelado': oc?.estado === E.CANCELADO}"
        *ngIf="module === 'ACEPTAR' || module === 'FINALIZAR'
          || (submodule === 'ORDEN DE CARGA (directa)' || submodule === 'ANTICIPO (directo)'
          || submodule === 'RECEPCION directa'
          || submodule === 'ORDEN DE CARGA')
           || module === 'CONCILIAR'" >
          <label for="estado-input" class="estado-label">ESTADO OC</label>
          <input
            id="estado-input"
            type="text"
            [value]="estado"
            [ngClass]="{'button-disabled': isFormSubmitting}"
            [readonly]="isFormSubmitting"
            class="estado-input"
          />
        </div>

        <div class="anticipo-toggle-container"
            *ngIf="(oc?.estado === E.ACEPTADO
                  || oc?.estado === E.FINALIZADO
                  || module === 'CONCILIAR')
                  && (submodule !== 'ACEPTAR'
                  && (submodule === 'ORDEN DE CARGA (directa)'
                  || submodule === 'ANTICIPO (directo)'
                  || submodule === 'ORDEN DE CARGA')
              )">
            <label class="anticipo-label">Anticipos</label>
            <button
              *ngIf="(submodule === 'ORDEN DE CARGA (directa)'
                      || submodule === 'ANTICIPO (directo)'
                      || submodule === 'ORDEN DE CARGA')
                      && (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId)
                      || oc?.estado === E.ACEPTADO
                      || (oc?.estado === E.FINALIZADO && puedeConciliar)
                      || module === 'CONCILIAR'"
              mat-mini-fab
              class="botones" type="button"
              [ngClass]="{
                'anticipo-toggle-button-active': isAnticipoActive,
                'anticipo-toggle-button-inactive': !isAnticipoActive,
                'disabled': isFormSubmitting || isShow
              }"
              color="warn"
              [disabled]="isFormSubmitting"
              (click)="activeClick.emit($event)">
              <mat-icon>{{ isAnticipoActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
          </button>
        </div>

        <button
          mat-flat-button
          class="botones"
          color="primary"
          type="button"
          matTooltip="Orden"
          [class.disabled]="!isFormSaved && oc?.estado !== E.CANCELADO && oc?.estado !== E.FINALIZADO && oc?.estado !== 'Conciliado'"
          *ngIf="(module === 'CONCILIAR' && (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId)) ||
                  oc?.estado === E.CANCELADO ||
                  oc?.estado === E.FINALIZADO ||
                  oc?.estado === 'Conciliado' &&
                  submodule !== 'RECEPCION directa'"
          (click)="downloadResumenPDF()">
        <mat-icon>description</mat-icon> RESUMEN
        </button>

        <button
          mat-flat-button
          class="botones"
          color="primary"
          type="button"
          matTooltip="Orden"
          *ngIf="(submodule !== 'ACEPTAR' && submodule === 'ANTICIPO (directo)') ||
                submodule === 'ORDEN DE CARGA' ||
                submodule === 'ORDEN DE CARGA (directa)' &&
                (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId) &&
                module !== 'CONCILIAR'"
          [disabled]="isFormSubmitting"
          (click)="previewPDF()">
          <mat-icon>visibility</mat-icon> VER OC
        </button>

        <button
            mat-flat-button
            class="botones" color="primary"
            type="button"
            *ngIf="(oc?.estado === 'Nuevo' || module === 'ACEPTAR')
                    && submodule !== 'ORDEN DE CARGA (directa)'
                  && oc?.estado !== 'Cancelado'"
            [class.disabled]="!(modelo | puede: a.CAMBIAR_ESTADO)"
            [ngClass]="{'disabled': isFormSubmitting || isShow}"
            (click)="aceptarClick.emit($event)">
            ACEPTAR
        </button>

        <button
          *ngIf="oc?.estado === E.ACEPTADO && submodule === 'ORDEN DE CARGA' && isEdit"
          mat-flat-button
          class="botones"
          color="accent"
          type="button"
          (click)="remitirClick.emit($event)"
          [class.disabled]="!(modelo | puede: a.CAMBIAR_ESTADO) ||
          (oc?.estado === E.NUEVO)|| oc?.cantidad_destino || oc?.cantidad_origen"
          >
          RE-EMITIR OC
        </button>

        <button
          *ngIf="(oc?.estado !== 'Finalizado' &&
                  oc?.estado !== 'Conciliado' &&
                  (module === 'ACEPTAR' || oc?.estado === E.ACEPTADO))
                  && oc?.estado !== 'Cancelado'
                  && submodule !== 'RECEPCION directa'
                  && submodule !== 'ANTICIPO (directo)'
                  && submodule !== 'ANTICIPOS'
                  && submodule !== 'ORDEN DE CARGA (directa)'"
          mat-flat-button
          class="botones"
          color="warn"
          type="button"
          [class.disabled]="!(modelo | puede: a.CAMBIAR_ESTADO) || oc?.estado === E.CANCELADO || isFormSubmitting"
          [ngClass]="{'disabled': isFormSubmitting || isShow}"
          (click)="cancelarClick.emit($event)">
          CANCELAR
        </button>

        <button
        *ngIf="(modelo | puede: a.FINALIZAR) &&
              (oc?.estado === 'Aceptado' ||
                module === 'FINALIZAR' ||
                submodule === 'RECEPCION directa') &&
              (oc?.estado !== 'Finalizado') &&
              (oc?.estado !== 'Conciliado') &&
              (oc?.estado !== 'Cancelado') &&
              (oc?.estado !== 'Nuevo') &&
              submodule !== 'ORDEN DE CARGA (directa)' &&
              submodule !== 'ANTICIPO (directo)' &&
              !isShow"
        mat-stroked-button
        class="botones"
        type="button"
        [class.disabled]="!oc?.cantidad_origen || !oc?.cantidad_destino"
        [ngClass]="{'button-disabled': isFormSubmitting || isShow}"
        (click)="finalizarClick.emit($event)">
        FINALIZAR
      </button>


        <button
          *ngIf="(oc?.estado === E.FINALIZADO || module === 'CONCILIAR')
                  && oc?.estado !== E.CONCILIADO && !isShow
                  && submodule !== 'RECEPCION directa'"
          mat-stroked-button
          class="botones"
          type="button"
          [class.disabled]="!(modelo | puede: a.CONCILIAR) || !oc?.cantidad_destino || cambiarPedido"
          [ngClass]="{'button-disabled': isFormSubmitting || isShow}"
          (click)="conciliarClick.emit($event)">
          CONCILIAR
        </button>

        <button
          *ngIf="(oc?.estado === E.FINALIZADO || module === 'CONCILIAR')
                  && oc?.estado !== E.CONCILIADO && !isShow
                  && submodule !== 'RECEPCION directa'"
          mat-stroked-button
          class="botones"
          type="button"
          [class.disabled]="!(modelo | puede: a.CONCILIAR) || !oc?.cantidad_destino || cambiarPedido"
          [ngClass]="{'button-disabled': isFormSubmitting || isShow}"
          (click)="provisionesClick.emit($event)"
          matTooltip="Recalcular Provisiones">
          PROVISION
        </button>
<!--
        <button
          mat-flat-button
          class="botones" color="accent"
          type="button"
          [disabled]="true"
          *ngIf="submodule === 'ORDEN DE CARGA (directa)'
          || submodule === 'ANTICIPO (directo)'">
          <mat-icon>visibility</mat-icon> Ver OC
        </button> -->

        <button
          class="botones" type="button"
          mat-mini-fab
          color="primary"
          matTooltip="Exportar lista"
          [disabled]="loading"
          (click)="downloadClick.emit($event)"
          *ngIf="shouldShowDownloadButton && (modelo | puede: a.REPORTE)">
          <mat-icon>download</mat-icon>
        </button>

        <div *ngIf="(modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId) && (isEdit || isShow) && (shouldShowInactiveButton || shouldShowActiveButton)">
          <button
            mat-mini-fab
            class="botones"
            color="warn"
            type="button"
            matTooltip="Activar"
            [disabled]="loading || isShow"
            (click)="activeClick.emit($event)"
            *ngIf="
              shouldShowActiveButton &&
              (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId)
            " >
            <mat-icon>toggle_off</mat-icon>
          </button>

          <button
            mat-mini-fab
            class="botones"
            color="accent"
            type="button"
            [matTooltip]="inactiveTooltipText"
            [disabled]="loading || isShow"
            (click)="inactiveClick.emit($event)"
            *ngIf="
              shouldShowInactiveButton &&
              (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId)
            " >
            <mat-icon>toggle_on</mat-icon>
          </button>
          {{ (shouldShowInactiveButton || shouldShowActiveButton) ? shouldShowActiveButton ? 'No Activo' : 'Activo' : '' }}
        </div>

        <!-- En algun momento mejorar, si hizo asi por falta de tiempo. Dos copiar uno para ver y otro para editar -->
        <button
          type="button"
          mat-flat-button
          color="accent"
          *ngIf="flete && isShow"
          (click)="copiarShowFleteClick.emit($event)"
          class="botones">
          COPIAR
        </button>

        <button
          type="button"
          mat-flat-button
          color="accent"
          *ngIf="flete && !isShow && !isCopyFlete && !isShowCopiedFlete"
          (click)="copiarFleteClick.emit($event)"
          class="botones">
          COPIAR
        </button>
    <!------------------------------------------------------------------------------------------------------------->
        <ng-container>
          <button
            type="button"
            mat-flat-button
            color="warn"
            *ngIf="flete && flete.estado !== 'Cancelado' && isShow"
            (click)="cancelarFleteClick.emit($event)"
            class="botones"
          >
            CANCELAR
          </button>
        </ng-container>

        <button
          mat-flat-button
          type="button"
          color="warn"
          class="botones"
          matTooltip="Editar"
          [disabled]="loading"
          (click)="editClick.emit($event)"
          *ngIf="
            isShow && flete?.estado !== E.CANCELADO && !flete?.is_in_orden_carga &&
            !hideEditButton &&
            (modelo | puede: a.EDITAR:gestorCargaId)
          ">
          <mat-icon>save</mat-icon>EDITAR
        </button>

        <button
          mat-flat-button
          class="botones"
          color="primary"
          type="button"
          matTooltip="Cambiar Pedido"
          [ngClass]="{
            'disabled-button': oc?.estado === 'Conciliado'
          }"

          [disabled]="isButtonPressed"
          (click)="cambiarFleteClick.emit($event)"
          *ngIf="isOc && (modelo | puede: a.CAMBIAR_ESTADO:gestorCargaId)
            && !isShow  && estado !== 'Cancelado'"
          >
          CAMBIAR PEDIDO
        </button>

        <button
          mat-flat-button
          color="primary"
          type="button"
          matTooltip="Limpiar"
          class="botones"
          (click)="nuevoClick.emit($event); $event.stopPropagation()"
          [disabled]="!nuevoActive"
          *ngIf="formNuevaOc">
          <mat-icon >add_circle</mat-icon>
        {{
          submodule === 'ANTICIPO (directo)' ? 'NUEVO ANTICIPO' :
          submodule === 'RECEPCION directa' ? 'NUEVA RECEPCION' :
          submodule === 'ORDEN DE CARGA (directa)' ? 'NUEVA ORDEN' :
          module === 'FINALIZAR' ? 'NUEVO FINALIZAR' :
          submodule === 'Todas las CUENTAS CORRIENTES' ? 'MOVIMIENTO' : 'Elemento'
          }}
        </button>

      <!-- <div *ngIf="flete && isShow  " style="margin-left: 8px; margin-right: 14px;"> -->
        <button
          mat-flat-button
          type="submit"
          color="primary"
          [matTooltip]="tooltipBtnGuardar"
          [disabled]="loading || isDataLoaded || isEditPressed"
          *ngIf="(!isShow && !hideSaveButton) "
          class="botones"
        >
          <mat-icon>save</mat-icon>
          {{labelBtnGuardar}}
        </button>

      </div>

    </div>

    <div class="page-content page-size" >

      <hr>
      <ng-content></ng-content>

    </div>

  </div>

  <div *ngIf="isDialog" mat-dialog-actions>
    <button mat-raised-button type="button" mat-dialog-close>Cancelar</button>
    <button *ngIf="!isShow"
      mat-raised-button
      type="button"
      (click)="crearDialog()"
      cdkFocusInitial
      color="primary"
      id="submit-button">
      Guardar
    </button>
  </div>

</form>
